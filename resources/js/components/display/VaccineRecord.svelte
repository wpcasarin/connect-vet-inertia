<script>
  import axios from 'axios';
  import FaRegCalendar from 'svelte-icons/fa/FaRegCalendar.svelte';
  import FaCheck from 'svelte-icons/fa/FaCheck.svelte';
  // props
  export let vaccine = 'vaccine';
  export let currentDose;
  export let nextDose;
  export let vetId;

  const handleDate = (dateTime) => {
    const date = new Date(dateTime);
    const [month, day, year] = [
      date.getMonth(),
      date.getDate(),
      date.getFullYear(),
    ];
    return `${day}/${month + 1}/${year}`;
  };
  const getVetCrmv = async () => {
    try {
      const resp = await axios.get(`/vets/${vetId}`);
      return resp.status === 200 && resp.data.vet_crmv;
    } catch (error) {
      alert(error);
    }
  };
</script>

<article class="flex flex-col gap-3 rounded-md px-6 py-4">
  <h3 class="flex items-center gap-x-2 py-3 text-neutral">
    <svg
      class="h-8 w-8"
      width="100%"
      height="100%"
      viewBox="0 0 346 350"
      fill="currentColor"
      xmlns="http://www.w3.org/2000/svg">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M7.94873 82.7926C5.84114 80.6844 4.65717 77.8254 4.65717 74.8444C4.65717 71.8634 5.84114 69.0044 7.94873 66.8962L71.5541 3.29084C72.5985 2.24707 73.8382 1.41922 75.2026 0.854579C76.5669 0.289935 78.0291 -0.000450613 79.5057 5.24852e-07C80.9823 0.000451663 82.4443 0.291733 83.8083 0.857211C85.1723 1.42269 86.4116 2.25129 87.4554 3.2957C88.4992 4.34012 89.327 5.5799 89.8916 6.94425C90.4563 8.3086 90.7467 9.7708 90.7462 11.2474C90.7458 12.7239 90.4545 14.186 89.889 15.55C89.3235 16.914 88.4949 18.1533 87.4505 19.197L79.5023 27.1356L119.243 66.8767L151.046 35.0838C153.154 32.9745 156.014 31.789 158.996 31.7881C160.472 31.7876 161.935 32.078 163.299 32.6427C164.663 33.2073 165.903 34.0352 166.947 35.0789C167.992 36.1227 168.82 37.362 169.386 38.726C169.951 40.09 170.243 41.552 170.243 43.0286C170.244 44.5052 169.953 45.9674 169.389 47.3317C168.824 48.6961 167.996 49.9358 166.952 50.9803L151.046 66.8864L286.205 202.045C293.94 209.782 299.25 219.606 301.485 230.315C303.72 241.024 302.783 252.153 298.788 262.337L310.05 273.599C315.928 279.477 317.872 287.814 315.88 295.316L341.852 321.288C342.897 322.333 343.725 323.573 344.29 324.937C344.856 326.302 345.147 327.764 345.147 329.241C345.147 330.718 344.856 332.181 344.29 333.546C343.725 334.91 342.897 336.15 341.852 337.194C340.808 338.239 339.568 339.067 338.203 339.633C336.839 340.198 335.376 340.489 333.899 340.489C332.422 340.489 330.96 340.198 329.595 339.633C328.231 339.067 326.991 338.239 325.946 337.194L299.974 311.222C296.159 312.244 292.143 312.244 288.328 311.221C284.514 310.197 281.037 308.187 278.247 305.392L266.995 294.14C256.81 298.134 245.681 299.07 234.972 296.833C224.262 294.596 214.438 289.284 206.703 281.547L185.91 260.753L251.662 194.991L137.297 80.6258L85.2837 132.649L108.312 155.668H80.8238L71.5443 146.388L55.6479 162.285C54.6108 163.358 53.3703 164.215 51.9987 164.804C50.6271 165.393 49.152 165.703 47.6593 165.716C46.1667 165.729 44.6864 165.444 43.3048 164.879C41.9233 164.314 40.6681 163.479 39.6126 162.423C38.5571 161.368 37.7224 160.113 37.1571 158.731C36.5918 157.35 36.3074 155.869 36.3203 154.377C36.3332 152.884 36.6432 151.409 37.2323 150.037C37.8214 148.666 38.6778 147.425 39.7514 146.388L71.5541 114.586L31.8129 74.8444L23.8452 82.7926C21.737 84.9002 18.878 86.0842 15.897 86.0842C12.9159 86.0842 10.057 84.9002 7.94873 82.7926V82.7926ZM65.7629 40.8846L105.504 80.6258L85.2934 100.836L45.5522 61.0953L65.7629 40.8846V40.8846ZM220.443 267.798L215.545 262.901L267.559 210.878L272.456 215.775C277.521 220.838 280.999 227.27 282.463 234.28C283.926 241.291 283.312 248.577 280.696 255.244L259.902 276.038C253.236 278.654 245.952 279.267 238.943 277.804C231.934 276.34 225.504 272.863 220.443 267.798V267.798ZM286.205 281.537C285.485 282.259 284.743 282.959 283.98 283.636L291.986 291.643C292.27 291.927 292.606 292.152 292.976 292.306C293.347 292.46 293.744 292.539 294.145 292.54C294.546 292.54 294.943 292.462 295.314 292.308C295.685 292.155 296.022 291.931 296.305 291.648C296.589 291.364 296.815 291.028 296.969 290.658C297.123 290.287 297.202 289.89 297.202 289.489C297.203 289.088 297.124 288.691 296.971 288.32C296.818 287.949 296.594 287.612 296.31 287.328L288.304 279.322C287.624 280.079 286.924 280.818 286.205 281.537Z"
        fill="currentColor" />
      <path
        d="M97.1671 213.968C99.7442 213.968 102.216 214.992 104.038 216.814C105.86 218.636 106.884 221.108 106.884 223.685V243.118H126.317C128.894 243.118 131.366 244.142 133.188 245.964C135.01 247.786 136.034 250.258 136.034 252.835C136.034 255.412 135.01 257.883 133.188 259.705C131.366 261.528 128.894 262.551 126.317 262.551H106.884V281.985C106.884 284.562 105.86 287.033 104.038 288.855C102.216 290.678 99.7442 291.701 97.1671 291.701C94.5901 291.701 92.1187 290.678 90.2964 288.855C88.4742 287.033 87.4505 284.562 87.4505 281.985V262.551H68.0171C65.4401 262.551 62.9687 261.528 61.1464 259.705C59.3242 257.883 58.3005 255.412 58.3005 252.835C58.3005 250.258 59.3242 247.786 61.1464 245.964C62.9687 244.142 65.4401 243.118 68.0171 243.118H87.4505V223.685C87.4505 221.108 88.4742 218.636 90.2964 216.814C92.1187 214.992 94.5901 213.968 97.1671 213.968V213.968Z"
        fill="currentColor" />
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M25.8468 308.111C42.5548 329.268 66.0142 344.054 92.3088 350C118.602 344.057 142.062 329.275 158.771 308.121C175.586 286.841 184.697 260.492 184.617 233.371V198.42C184.617 192.23 182.188 186.303 177.864 181.931C175.731 179.768 173.189 178.051 170.387 176.878C167.585 175.706 164.578 175.101 161.54 175.1H23.0872C16.9657 175.1 11.0969 177.558 6.76324 181.931C2.42644 186.323 -0.00358403 192.248 0.000432785 198.42V233.381C-0.0723537 260.492 9.03783 286.83 25.8468 308.102V308.111ZM165.184 233.39V233.429C165.247 256.15 157.617 278.223 143.535 296.053C130.515 312.541 112.561 324.431 92.2991 329.984C72.044 324.428 54.0973 312.538 41.0825 296.053C26.9992 278.223 19.3686 256.15 19.4338 233.429V198.42C19.4338 197.322 19.871 196.311 20.5706 195.602C20.8952 195.267 21.2832 195 21.7119 194.817C22.1406 194.633 22.6015 194.537 23.0678 194.533H161.55C162.444 194.533 163.347 194.893 164.047 195.602C164.781 196.356 165.189 197.368 165.184 198.42V233.381V233.39Z"
        fill="currentColor" />
    </svg>
    <span class="vvvvvvv truncate text-2xl font-bold first-letter:capitalize"
      >{vaccine}</span>
  </h3>
  <div class="flex gap-x-3 rounded-md bg-success py-2 px-3">
    <span class="aspect-square w-6">
      <FaCheck />
    </span>
    <p class="font-medium">{handleDate(currentDose)}</p>
  </div>
  <div class="flex gap-x-3 rounded-md bg-warning py-2 px-3">
    <span class="aspect-square w-6">
      <FaRegCalendar />
    </span>
    <p class="font-medium">{handleDate(nextDose)}</p>
  </div>
  <p class="mt-2 text-sm font-medium text-gray-500">
    <span>CRMV</span> - {#await getVetCrmv() then crmv}
      {crmv}
    {/await}
  </p>
</article>

<style>
  /* your styles go here */
  article {
    background-color: rgba(255, 255, 255, 0.7);
    /* backdrop-filter: blur(25px); */
    box-shadow: 3px 3px 14px #cbced1, -3px -3px 14px #fff;
  }
</style>
